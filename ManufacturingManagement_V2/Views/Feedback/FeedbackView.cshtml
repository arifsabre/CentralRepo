@model IEnumerable<ManufacturingManagement_V2.Models.FeedbackMdl>
@{
    ViewBag.Title = "ComplaintView";
    Layout = "~/views/shared/_LayoutCommon.cshtml";
}

<h4><b>Feedback Posting</b></h4>
@*<div style="font-size:14pt;color:black;background-color:yellow;text-align:center;">
       <b>Feedback Posting</b>
    </div>*@
@if (ViewBag.ReplyMsg == "1")
{
    @Html.ActionLink("Reply-Feedback", "ReplyView", null, new { @class = "btn btn-default" })
    @Html.ActionLink("Close", null, null, new { @onclick = "window.close();", @class = "btn btn-default" })
}
else
{
    @Html.ActionLink("Close", null, null, new { @onclick = "window.close();", @class = "btn btn-default" })
}
<fieldset>
    @*<legend>Feedback Detail</legend>*@
    @using (Ajax.BeginForm("FilterFeedbackView", "Feedback", new AjaxOptions { UpdateTargetId = "divFilter" }))
    {
        <div class="form-group">
            <table class="table table-bordered">
                <tr>
                    <td><b>Feedback/ Suggestion</b>
                    <td>
                    <td>
                        <textarea id="txtSuggestion" rows="2" cols="80" maxlength="250"
                                  placeholder="Max :Length: 250 Chars"></textarea>
                    </td>
                    <td>
                        <input id="submit" class="btn btn-default" type="button" value='Submit'
                               onclick="CreateFeedback();"/>
                    </td>
                </tr>
                <tr>
                    <td style="width:5%;"><b>Status</b>
                    <td>
                    <td style="width:35%;">
                        @Html.DropDownList("ddlFBStatus", ViewBag.FBStatusList as SelectList)
                    </td>
                    <td style="width:60%">
                        <button class="btn btn-default">Display</button>
                    </td>
                </tr>
            </table>
        </div>
    }
</fieldset>

<table class="tablecontainer" style="width:100%;">
    <tr>
        <th style="width:35px;">
            S.No.
        </th>
        <th style="width:100px;">
            @Html.DisplayNameFor(model => model.EntryDTStr)
        </th>
        <th style="width:120px;">
            @Html.DisplayNameFor(model => model.SendingUserName)
        </th>
        <th style="width:auto;">
            @Html.DisplayNameFor(model => model.Suggestion)
        </th>
        <th style="width:50px;">
            @Html.DisplayNameFor(model => model.FBStatusName)
        </th>
        <th style="width:50px;">
            @Html.DisplayNameFor(model => model.ReplyUserName)
        </th>
        <th style="width:50px;">
            @Html.DisplayNameFor(model => model.ReplyMsg)
        </th>
        <th style="width:50px;">
            @Html.DisplayNameFor(model => model.ReplyDTStr)
        </th>
        <th style="width:45px;"> Update </th>
    </tr>
    @{int i = 1;}
    @foreach (var item in Model)
    {
        <tr>
            <td>
                @i
            </td>
            <td>
                @Html.DisplayFor(model => item.EntryDTStr)
            </td>
            <td>
                @Html.DisplayFor(model => item.SendingUserName)
            </td>
            <td>
                @Html.DisplayFor(model => item.Suggestion)
            </td>
            <td>
                @Html.DisplayFor(model => item.FBStatusName)
            </td>
            <td>
                @Html.DisplayFor(model => item.ReplyUserName)
            </td>
            <td>
                @Html.DisplayFor(model => item.ReplyMsg)
            </td>
            <td>
                @Html.DisplayFor(model => item.ReplyDTStr)
            </td>
            <td>
                @Html.ActionLink("Update", null, new { recid = item.RecId }, new { onclick = "UpdateFeedback('" + item.RecId + "')" })
            </td>
        </tr>
        i++;
    }

</table>

@section Scripts{
    @*@Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/themes/base/css")*@
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script type="text/javascript">
        $(function () {
            //$("input[type=text]").first().focus();
            document.getElementById("ddlFBStatus").value = '@ViewBag.Status';
        });
    </script>

    <script>
        function CreateFeedback() {
            var compmsg = $('#txtSuggestion').val();
            if (compmsg.trim() == '') {
                alert('No Suggestion entered!');
                return;
            }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("CreateFeedback", "Feedback")',
            dataType: 'html',
            data: ({
                suggestion: compmsg
            }),
            success: function () {
                //alert("Successfully posted!");
            }
        });
        location.reload();
    }
    </script>

    <script>
    function UpdateFeedback(recid) {
        var compmsg = $('#txtSuggestion').val();
        if (compmsg.trim() == '') {
            alert('No Suggestion entered!');
            return;
        }
        $.ajax({
            type: 'POST',
            url: '@Url.Action("UpdateFeedback", "Feedback")',
            dataType: 'html',
            data: ({
                recid: recid,
                suggestion: compmsg
            }),
            success: function () {
                //alert("Successfully posted!");
            }
        });
        location.reload();
    }
    </script>

}