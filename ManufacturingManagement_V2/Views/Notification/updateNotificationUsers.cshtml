@model ManufacturingManagement_V2.Models.NotificationMdl
@using Newtonsoft.Json
@{
    ViewBag.Title = "Index";
    Layout = "~/views/shared/_LayoutCommon.cshtml";
}

<h4><b>Notification Recipients</b></h4>

@Html.Partial("NotificationLinks")

@Html.HiddenFor(model => model.NoticeId)
<p style="font-size:16px;font-weight:bold;">
    Notice Number: @Html.DisplayFor(model => model.NoticeNo),&nbsp;
    Date: @Html.ValueFor(model => model.NoticeDT, "{0:dd/MM/yyyy hh:mm tt}")
    <br/>Notice: @Html.DisplayFor(model => model.NoticeMsg)
</p>

<table id="StepsTable" class="tablecontainer" style="width:100%;">
    <tr>
        <th style="width:30px;">
           S.No.
        </th>
        <th style="display:none;">
           RecId
        </th>
        <th style="display:none;">
           Receiving User
        </th>
        <th style="width:auto;">
           Recipients
        </th>
        <th style="width:90px;">
           Set To Add
        </th>
    </tr>
    @{int i = 1;}
@foreach (var item in Model.NotificationUsers)
{
    <tr>
        <td>
            <b>@i</b>
        </td>
        <td class="indexColumn" style="display:none;">
            @*@Html.HiddenFor(model => item.RecId)*@
            @Html.Label("lblRecId"+i.ToString(),item.RecId.ToString(),new { @id = "RecId" + (i-1)})
        </td>
        <td class="indexColumn" style="display:none;">
            @Html.Label("lblReceivingUser"+i.ToString(),item.ReceivingUser,new { @id = "ReceivingUser" + (i-1)})
        </td>
        <td>
            @Html.Label("lblReceivingUsername"+i.ToString(),item.ReceivingUsername.ToString(),new { @id = "ReceivingUsername" + (i-1)})
        </td>
        <td>
            @*@Html.CheckBox("txtsetUser"+i.ToString(),true,new { @id = "setUser" + (i-1),style = "width: 85px; height: 25px; padding: 0; text-align:center;" })*@
            @Html.CheckBox("chksetUser"+i.ToString(),item.setUser,new { @id = "setUser" + (i-1),style = "width: 80px; height: 18px; padding: 0; text-align:center;" })
            @*@Html.TextBox("txtsetUser"+i.ToString(),item.setUser,new { @id = "setUser" + (i-1),style = "width: 85px; height: 25px; padding: 0; text-align:center;" })*@
        </td>
    </tr>
    i++;
}

</table>

<h5><b>@ViewBag.Message</b></h5>
        <p>
            @*<input type="submit" class="btn btn-default" value="Submit" />*@
            <input id="update" class="btn btn-default" type="button" value="Send" />
        </p>
@Html.Partial("NotificationLinks")

@section Scripts{
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            
            $("#update").click(function () {
                var empatt = [];
                //Collects the data from textboxes and adds it to the dictionary
                $("#StepsTable tr").each(function (index, item) {
                    if (index > 0)
                    {
                        var tds = $(this).find("td");
                        var recid = $(tds).eq(1).text();
                        var recuser = $(tds).eq(2).text();
                        var recusername = $(tds).eq(3).text();
                        //var textboxValue = $(tds).eq(4).find("input").val();//setUser
                        //var x = document.getElementById("myCheck").value;
                        var chkboxValue = $(tds).eq(4).find("input").is(':checked');//setUser
                        empatt.push({
                            RecId: recid,
                            ReceivingUser: recuser,
                            setUser: chkboxValue
                        });
                    }
                });
                $(this).val('Please wait...');

                var data = {
                    NoticeId: '@Model.NoticeId',
                    NotificationUsers: empatt
                }
                //Makes ajax call to controller 
                $.ajax({
                    url: "/Notification/updateNotificationUsers",
                    type: "POST",
                    data: JSON.stringify(data),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (d) {
                        //check is successfully save to database 
                        if (d.status == true) {
                            //will send status from server side
                            alert(d.message);
                            //clear form
                            empatt = [];
                            //$('#orderNo').val('');
                            //$('#orderDate').val('');
                            //$('#orderItems').empty();
                        }
                        else {
                            alert(d.message);
                        }
                        $('#update').val('Send');
                    },
                    error: function () {
                        alert('Error. Please try again.');
                        //$('#approve').val(d.AddEdit);//not applicable here
                    }
                });

            });
            
        });
    </script>
  
}



