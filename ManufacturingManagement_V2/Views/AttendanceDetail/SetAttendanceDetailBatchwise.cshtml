@model ManufacturingManagement_V2.Models.AttendanceDetailBatchMdl
@using Newtonsoft.Json
@{
    ViewBag.Title = "Index";
    Layout = "~/views/shared/_LayoutCommon.cshtml";
}

<h2>Attendance List</h2>

<p>
    @Html.ActionLink("Attendance Detail", "../AttendanceDetail/Index", null, new { @class = "btn btn-default" })
</p>
    @Html.HiddenFor(model => model.AttYear)
    @Html.HiddenFor(model => model.AttMonth)
    @Html.HiddenFor(model => model.AttShift)
    @Html.HiddenFor(model => model.AttDay)
<p style="font-size:16px;font-weight:bold;">
    Grade: @Html.DisplayFor(model => model.GradeName)<br/>
    Attendance For: @Html.DisplayFor(model => model.MonthName) @Html.DisplayFor(model => model.AttDay), @Html.DisplayFor(model => model.AttYear) - @Html.DisplayFor(model => model.ShiftName) Shift <br/>
</p>
@Html.ActionLink("Back", null,null,new{@onclick="window.close()"})
<table id="StepsTable" class="tablecontainer" style="width:100%;">
    <tr>
        <th>
           S.No.
        </th>
        <th>
           EMP Code
        </th>
        <th>
           Employee Name
        </th>
        <th>
           Father's Name
        </th>
        <th>
           Att.Hours
        </th>
        <th style="visibility:hidden;">
           RecId
        </th>
    </tr>
    @{int i = 1;}
@foreach (var item in Model.EmpAttendance)
{
    <tr>
        <td>
            <b>@i</b>
        </td>
        <td>@Html.HiddenFor(model => item.EmpId)
           @Html.Label("lblEmpId"+i.ToString(),item.EmpId,new { @id = "EmpId" + (i-1)})
        </td>
        <td>
            @Html.Label("lblEmpName"+i.ToString(),item.EmpName)
        </td>
        <td>
            @Html.Label("lblFatherName"+i.ToString(),item.FatherName)
        </td>
        <td>
            @Html.TextBox("txtAttHours"+i.ToString(),item.AttHours,new { @id = "AttHours" + (i-1), style = "width: 65px; height: 25px; padding: 0; text-align:center;"})
        </td> 
        <td class="indexColumn" style="visibility:hidden;">@Html.HiddenFor(model => item.RecId)
            @Html.Label("lblRecId"+i.ToString(),item.RecId)
        </td>
    </tr>
    i++;
}

</table>

<h5><b>@ViewBag.Message</b></h5>
        <p>
            @*<input type="submit" class="btn btn-default" value="Submit" />*@
            <input id="submit" type="button" value="Submit" style="padding:10px 20px" />
            @Html.ActionLink("Back", null,null,new{@onclick="window.close()"})
        </p>

@section Scripts{
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {

            $("#submit").click(function () {

                
                var empatt = [];

                //Collects the data from textboxes and adds it to the dictionary
                $("#StepsTable tr").each(function (index, item) {
                    if (index > 0)
                    {
                        var tds = $(this).find("td");
                        var empid = $(tds).eq(1).text();
                        //var empname = $(tds).eq(2).text();
                        //var fathername = $(tds).eq(3).text();
                        var atthours = $(tds).eq(4).find("input").val();
                        var recid = $(tds).eq(5).text();
                        empatt.push({
                            EmpId: empid,
                            //EmpName: empname,
                            //FatherName: fathername,
                            AttValue: 'inc',
                            AttHours: atthours,
                            RecId: recid
                        });
                    }
                });
                
                $(this).val('Please wait...');

                var data = {
                    AttYear: '@Model.AttYear',
                    AttMonth: '@Model.AttMonth',
                    AttShift: '@Model.AttShift',
                    AttDay: '@Model.AttDay',
                    EmpAttendance: empatt
                }
                
                //Makes ajax call to controller 
                $.ajax({
                    url: "/AttendanceDetail/SetAttendanceDetailBatchwise",
                    type: "POST",
                    data: JSON.stringify(data),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (d) {
                        //check is successfully save to database 
                        if (d.status == true) {
                            //will send status from server side
                            alert(d.message);
                            //clear form
                            empatt = [];
                            //$('#orderNo').val('');
                            //$('#orderDate').val('');
                            //$('#orderItems').empty();
                        }
                        else {
                            alert(d.message);
                        }
                        $('#submit').val('Submit');
                    },
                    error: function () {
                        alert('Error. Please try again.');
                        $('#submit').val(d.AddEdit);
                    }
                });

            });

        });
    </script>

}


<style>
    /*Adding some css for looks good*/
    .col1 {
    width: 20px%;
}
    </style>